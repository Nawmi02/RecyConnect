{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="edu-awareness-container">
    <h2>Education & Awareness</h2>
    <p class="subtitle">
        <span>üå± Gain insights into waste management, sustainable practices, and protecting Earth</span>
    </p>

    {# Filter bar #}
    <form method="get" style="margin:0 0 14px 0; display:flex; gap:10px; flex-wrap:wrap;">
        <input type="hidden" name="tab" value="{{ active_tab }}">
        <input type="text" name="q" placeholder="Search title/topic/description..."
               value="{{ query }}" style="padding:8px 10px; border:1px solid #d1d5db; border-radius:10px; min-width:220px;">
        <select name="tag" style="padding:8px 10px; border:1px solid #d1d5db; border-radius:10px;">
            <option value="">All tags</option>
            {% for value,label in tag_choices %}
                <option value="{{ value }}" {% if selected_tag == value %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
        </select>
        <button type="submit" class="read-btn" style="line-height:1;">Filter</button>
        {% if query or selected_tag %}
            <a href="{% url 'education:education_awareness' %}?tab={{ active_tab }}" class="pdf-btn" style="line-height:1;">Reset</a>
        {% endif %}
    </form>

    {# Tabs #}
    <div class="edu-tabs">
        <a href="{% url 'education:education_awareness' %}?tab=guides{% if query %}&q={{ query|urlencode }}{% endif %}{% if selected_tag %}&tag={{ selected_tag }}{% endif %}"
           class="edu-tab-btn{% if active_tab == 'guides' %} active{% endif %}">
            <img src="{% static 'icon/book.png' %}" style="width:22px;vertical-align:middle;margin-right:6px;" alt="Guidelines"/>
            Guidelines & Articles
        </a>
        <a href="{% url 'education:education_awareness' %}?tab=videos{% if query %}&q={{ query|urlencode }}{% endif %}{% if selected_tag %}&tag={{ selected_tag }}{% endif %}"
           class="edu-tab-btn{% if active_tab == 'videos' %} active{% endif %}">
            <img src="{% static 'icon/video.png' %}" style="width:22px;vertical-align:middle;margin-right:6px;" alt="Video"/>
            Video
        </a>
        <a href="{% url 'education:education_awareness' %}?tab=tips{% if query %}&q={{ query|urlencode }}{% endif %}{% if selected_tag %}&tag={{ selected_tag }}{% endif %}"
           class="edu-tab-btn{% if active_tab == 'tips' %} active{% endif %}">
            <img src="{% static 'icon/tips.png' %}" style="width:22px;vertical-align:middle;margin-right:6px;" alt="Tips"/>
            Quick Tips
        </a>
    </div>

    {# -------- Guides + Articles -------- #}
    {% if active_tab == 'guides' %}
        <div class="guide-cards">
            {% for guide in items %}
            <div class="guide-card">
                <div class="guide-img">
                    {% if guide.image %}
                        <img src="{{ guide.image.url }}" alt="{{ guide.title }}">
                    {% else %}
                        <img src="{% static 'placeholder/guide.png' %}" alt="Guide">
                    {% endif %}
                </div>
                <div class="guide-content">
                    <h3>{{ guide.title }}</h3>
                    <div class="guide-meta">
                        <span>üåø {{ guide.get_category_display }}</span>
                        <span>üïí {{ guide.read_time }} mins</span>
                        <span>üì• {{ guide.downloads }} downloads</span>
                    </div>
                    <p class="guide-description">{{ guide.description }}</p>

                    {% if guide.tags.all %}
                    <div class="guide-tags">
                        {% for tag in guide.tags.all %}
                            <span class="guide-tag">{{ tag.get_name_display }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}

                    <div class="guide-actions">
                        {% if guide.pdf_file %}
                            <a href="{% url 'education:view_guide_pdf' guide.id %}" class="read-btn" target="_blank" rel="noopener">
                                <img src="{% static 'icon/read.png' %}" style="width:20px;vertical-align:middle;margin-right:6px;">Read Guide
                            </a>
                            <a href="{% url 'education:download_guide_pdf' guide.id %}" class="pdf-btn">
                                <img src="{% static 'icon/download.png' %}" style="width:20px;vertical-align:middle;margin-right:6px;">Download PDF
                            </a>
                        {% else %}
                            <span style="color:#6b7280;">No PDF attached</span>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% empty %}
                <p>No guides available.</p>
            {% endfor %}
        </div>

    {# -------- Videos -------- #}
    {% elif active_tab == 'videos' %}
        <div class="video-list">
            {% for video in items %}
                <div class="video-item">
                    {% if video.image %}
                        <img src="{{ video.image.url }}" alt="{{ video.title }}">
                    {% else %}
                        <img src="{% static 'placeholder/video.png' %}" alt="Video">
                    {% endif %}
                    <h4>{{ video.title }}</h4>
                    <p>{{ video.description }}</p>

                    {% if video.video_file %}
                        <div class="guide-actions">
                            <a href="{% url 'education:view_video' video.id %}" class="read-btn" target="_blank" rel="noopener">
                                <img src="{% static 'icon/video.png' %}" style="width:20px;vertical-align:middle;margin-right:6px;">See Video
                            </a>
                            <a href="{% url 'education:download_video' video.id %}" class="pdf-btn">
                                <img src="{% static 'icon/download.png' %}" style="width:20px;vertical-align:middle;margin-right:6px;">Download
                            </a>
                        </div>
                    {% else %}
                        <span style="color:#6b7280;">No video file</span>
                    {% endif %}
                </div>
            {% empty %}
                <p>No videos available.</p>
            {% endfor %}
        </div>

    {# -------- Quick Text (no buttons) -------- #}
    {% elif active_tab == 'tips' %}
        <div class="tips-list">
            {% for tip in items %}
                <div class="tip-item">
                    <h4>{{ tip.title }}</h4>
                    <p>{{ tip.quick_text }}</p>
                </div>
            {% empty %}
                <p>No tips available.</p>
            {% endfor %}
        </div>
    {% endif %}

    {# Pagination #}
    {% if page_obj.has_other_pages %}
    <div class="load-more" style="display:flex; gap:12px; justify-content:center; align-items:center;">
        {% if page_obj.has_previous %}
            <a href="{% url 'education:education_awareness' %}?tab={{ active_tab }}{% if query %}&q={{ query|urlencode }}{% endif %}{% if selected_tag %}&tag={{ selected_tag }}{% endif %}&page={{ page_obj.previous_page_number }}">‚¨ÖÔ∏è Prev</a>
        {% endif %}
        <span>Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
        {% if page_obj.has_next %}
            <a href="{% url 'education:education_awareness' %}?tab={{ active_tab }}{% if query %}&q={{ query|urlencode }}{% endif %}{% if selected_tag %}&tag={{ selected_tag }}{% endif %}&page={{ page_obj.next_page_number }}">Next ‚û°Ô∏è</a>
        {% endif %}
    </div>
    {% endif %}
</div>

<style>
/* Main container */
.edu-awareness-container { max-width: 900px; margin:30px auto 0 auto; padding: 30px 10px; min-height:500px; }

/* Tabs */
.edu-tabs { display: flex; gap: 10px; margin-bottom: 20px; background: #eaf1f5; border-radius: 22px; padding: 10px 14px;}
.edu-tab-btn { padding: 8px 22px; border-radius: 20px; background: none; color: #333; text-decoration: none; font-weight: 600; transition:.17s; border:none; }
.edu-tab-btn.active { background: #fff; color: #16a34a; border: 2px solid #16a34a; box-shadow: 0 1px 3px #d1fae5; }

/* Guide cards */
.guide-cards { display: flex; flex-direction: column; gap: 22px; }
.guide-card { display: flex; gap: 18px; background: #fff; border-radius: 18px; box-shadow: 0 2px 14px 0 #e7e7e7; padding: 18px; align-items: flex-start;}
.guide-img img { width: 120px; height: 120px; object-fit: cover; border-radius: 13px; }
.guide-content { flex: 1; }
.guide-meta { display: flex; gap: 18px; font-size: 15px; margin-bottom: 4px; color: #444; align-items: center; }
.guide-tags { margin: 8px 0; }
.guide-tag { display: inline-block; background: #e4f7ea; color: #15803d; border-radius: 14px; padding: 3px 14px; font-size: 13px; margin-right: 6px; margin-bottom: 4px;}
.guide-actions { margin-top: 10px; display: flex; gap: 16px; }
.read-btn, .pdf-btn { padding: 9px 18px; border-radius: 10px; font-weight: 600; text-decoration: none; background: #22c55e; color: #fff; box-shadow: 0 2px 6px #a7f3d0; display:inline-block;}
.pdf-btn { background: #22d3ee; }
.read-btn img, .pdf-btn img { filter: brightness(0) invert(1); }
.load-more { margin: 20px 0 0; text-align: center; }

/* Video, tips, etc. */
.video-list, .tips-list { display: flex; flex-direction: column; gap: 16px; }
.video-item, .tip-item { background: #fff; border-radius: 14px; box-shadow: 0 2px 8px 0 #dbeafe; padding: 13px;}
.video-item img { width: 100%; border-radius: 10px; }


@media (max-width: 900px) {
    .edu-awareness-container { padding: 18px 3vw;}
    .guide-card { flex-direction: column; align-items: stretch;}
    .guide-img img { width: 100%; max-width: 220px; height: auto;}
    .footer-container { flex-direction: column; align-items: flex-start; gap: 18px;}
    .footer-columns { flex-direction: column; gap: 18px;}
}
</style>
{% endblock %}
